-- BP 7.1.6 content: ModelClass syschar: 3 persistence-version: 7.1.6

INSERT INTO O_OBJ
	VALUES ("b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd",
	'waveform',
	40,
	'WAVE',
	'',
	"00000000-0000-0000-0000-000000000000");
INSERT INTO O_TFR
	VALUES ("b345f5a1-b95c-40a0-859e-f690634be4ae",
	"b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd",
	'init',
	'',
	"45ac1edb-87df-459d-8c77-913b855c087e",
	0,
	'create object instance wave of WAVE;
return wave;
',
	1,
	'',
	"00000000-0000-0000-0000-000000000000");
INSERT INTO S_DT_PROXY
	VALUES ("45ac1edb-87df-459d-8c77-913b855c087e",
	"00000000-0000-0000-0000-000000000000",
	'inst_ref<waveform>',
	'',
	'',
	'../wave.xtuml');
INSERT INTO O_TFR
	VALUES ("aab148aa-2f58-4b2a-a516-8c5d867ad7e2",
	"b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd",
	'cleanup',
	'',
	"ba5eda7a-def5-0000-0000-000000000000",
	1,
	'select one timelineevent related by self->TIMELINEEVENT[R10];
if ( not_empty timelineevent )
  unrelate self from timelineevent across R10;
end if;
delete object instance self;',
	1,
	'',
	"b345f5a1-b95c-40a0-859e-f690634be4ae");
INSERT INTO O_TFR
	VALUES ("0ca89f9e-dfd1-461c-a194-b79205482ddf",
	"b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd",
	'play',
	'',
	"ba5eda7a-def5-0000-0000-000000000000",
	1,
	'/*
Play out the waveform segment by segment.
*/
select one timelineevent related by self->TIMELINEEVENT[R10];
generate TIMELINEEVENT1:play() to timelineevent;',
	1,
	'',
	"aab148aa-2f58-4b2a-a516-8c5d867ad7e2");
INSERT INTO O_TFR
	VALUES ("6ffdb004-006b-4db0-b435-1c6c51a53623",
	"b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd",
	'PAD',
	'',
	"45ac1edb-87df-459d-8c77-913b855c087e",
	0,
	'wave = WAVE::init();
/*
seg = SEGMENT::init( number:1, DC_offset:0, period:200000, cycles:1, branch_offset:0, length:1 );
wave.add_segment( segment:seg );
seg = SEGMENT::init( number:2, DC_offset:0, period:800000, cycles:1, branch_offset:0, length:1 );
wave.add_segment( segment:seg );
seg = SEGMENT::init( number:3, DC_offset:0, period:400000, cycles:1, branch_offset:0, length:1 );
wave.add_segment( segment:seg );
*/
return wave;
',
	1,
	'',
	"0ca89f9e-dfd1-461c-a194-b79205482ddf");
INSERT INTO O_TFR
	VALUES ("b1a6b153-e4a5-418a-8c39-5ee73d8c92a2",
	"b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd",
	'parse',
	'',
	"ba5eda7a-def5-0000-0000-000000000000",
	0,
	'// Almost identical to dacq.  Refactor?
d = param.data;
i = 0;
name = ::itoa( i:d[i] ); i = i + 1;
experimentname = ::itoa( i:d[i] ); i = i + 1;
timeline_offset = d[i]; i = i + 1;
// Consider calculating this.
event_duration = d[i]; i = i + 1;
// See if a wave with the same name exists, if so, reuse it.
/*
 CDS - no, not this.  Instead, look for an event on the timeline at
 the same offset and of the same type.
 Only one waveform can exist at the same point on the timeline at the same time.
*/
select any wave from instances of WAVE where ( selected.name == name );
select one timelineevent related by wave->TIMELINEEVENT[R10];
if ( empty wave )
  timelineevent = TIMELINEEVENT::init( name:name, offset:timeline_offset, duration:event_duration );
  wave = WAVE::init();
  relate wave to timelineevent across R10;
  select any experiment from instances of EXPERIMENT where ( selected.name == experimentname );
  select one timeline related by experiment->TIMELINE[R13.''runs on''];
  if ( not_empty timeline )
    timeline.add( timelineevent:timelineevent );
  else 
    TRACE::log( id:1037, flavor:"failure", message:"failed to find default timeline for wave" );
  end if;
end if;
count = d[ i ]; i = i + 1;
while ( count > 0 )
  // CDS - Maybe check to see if segments already exist before creating new ones.
  segment = SEGMENT::init( number:d[i], period:d[i+1], cycles:d[i+2], branch_offset:d[i+3], length:d[i+4] );
  writing = WRITING::init( DC_offset:d[i+5] );
  relate writing to segment across R18;
  relate writing to wave across R40.''writes segment of'';
  timelineevent.add_segment( segment:segment );
  select one buffer related by segment->BUFFER[R19];
  buffer.deposit( data:d[i+6], length:d[i+4] );
  i = i + d[i+4] + 6;
  count = count - 1;
end while;
// Add event to timeline after all segments are accumulated.
// This allows full duration to be calculated.',
	1,
	'',
	"6ffdb004-006b-4db0-b435-1c6c51a53623");
INSERT INTO O_TPARM
	VALUES ("f515e7f6-3a46-4af3-a3f7-efa65b465b6a",
	"b1a6b153-e4a5-418a-8c39-5ee73d8c92a2",
	'data',
	"ba5eda7a-def5-0000-0000-000000000002",
	0,
	'[256]',
	"00000000-0000-0000-0000-000000000000",
	'');
INSERT INTO S_DIM
	VALUES (256,
	0,
	"00000000-0000-0000-0000-000000000000",
	"00000000-0000-0000-0000-000000000000",
	"00000000-0000-0000-0000-000000000000",
	"00000000-0000-0000-0000-000000000000",
	"00000000-0000-0000-0000-000000000000",
	"00000000-0000-0000-0000-000000000000",
	"00000000-0000-0000-0000-000000000000",
	"f515e7f6-3a46-4af3-a3f7-efa65b465b6a",
	"00000000-0000-0000-0000-000000000000",
	"00000000-0000-0000-0000-000000000000",
	"00000000-0000-0000-0000-000000000000",
	"00000000-0000-0000-0000-000000000000",
	"00000000-0000-0000-0000-000000000000",
	"00000000-0000-0000-0000-000000000000",
	"5ca0cbe1-62df-4956-a7cc-266ab60cf22f",
	"00000000-0000-0000-0000-000000000000");
INSERT INTO O_REF
	VALUES ("b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd",
	"641c0663-c7a2-40bf-a386-dcca59439e0e",
	0,
	"f18d7c78-fadc-4096-b9bd-acdd613fa72b",
	"5c10e785-cb13-4e96-a052-e5cdc230a4fb",
	"b93e3bbc-f312-43a5-84cd-0dd8023b15fa",
	"f51d67c5-d1fa-48fa-9fe8-46976334cd5b",
	"c03f72d3-0fee-472e-8690-0b0a1e44ace5",
	"fa50aa4e-98b2-4b2e-b8ba-684723c05627",
	"00000000-0000-0000-0000-000000000000",
	0,
	'',
	'timeline event',
	'name',
	'R10');
INSERT INTO R_RGO_PROXY
	VALUES ("b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd",
	"5c10e785-cb13-4e96-a052-e5cdc230a4fb",
	"b93e3bbc-f312-43a5-84cd-0dd8023b15fa",
	'../../experiment/experiment.xtuml');
INSERT INTO O_RTIDA_PROXY
	VALUES ("f18d7c78-fadc-4096-b9bd-acdd613fa72b",
	"641c0663-c7a2-40bf-a386-dcca59439e0e",
	0,
	"5c10e785-cb13-4e96-a052-e5cdc230a4fb",
	"f51d67c5-d1fa-48fa-9fe8-46976334cd5b",
	'../../experiment/experiment.xtuml');
INSERT INTO O_RATTR
	VALUES ("c03f72d3-0fee-472e-8690-0b0a1e44ace5",
	"b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd",
	"f18d7c78-fadc-4096-b9bd-acdd613fa72b",
	"641c0663-c7a2-40bf-a386-dcca59439e0e",
	1,
	'name');
INSERT INTO O_BATTR_PROXY
	VALUES ("f18d7c78-fadc-4096-b9bd-acdd613fa72b",
	"641c0663-c7a2-40bf-a386-dcca59439e0e",
	'../../experiment/timeline event/timeline event.xtuml');
INSERT INTO O_ATTR
	VALUES ("c03f72d3-0fee-472e-8690-0b0a1e44ace5",
	"b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd",
	"00000000-0000-0000-0000-000000000000",
	'name',
	'',
	'',
	'name',
	0,
	"ba5eda7a-def5-0000-0000-000000000007",
	'',
	'');
INSERT INTO O_ID
	VALUES (0,
	"b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd");
INSERT INTO O_OIDA
	VALUES ("c03f72d3-0fee-472e-8690-0b0a1e44ace5",
	"b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd",
	0,
	'name');
INSERT INTO O_ID
	VALUES (1,
	"b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd");
INSERT INTO O_ID
	VALUES (2,
	"b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd");
INSERT INTO PE_PE
	VALUES ("b6ea1a8e-6c18-4c30-a106-1d0b1bde92dd",
	1,
	"756e2fa8-d9b5-49f0-9bf0-80f37f535bb5",
	"00000000-0000-0000-0000-000000000000",
	4);
INSERT INTO EP_PKG_PROXY
	VALUES ("756e2fa8-d9b5-49f0-9bf0-80f37f535bb5",
	"00000000-0000-0000-0000-000000000000",
	"dbf92ecc-a444-472c-a2b6-e80ac235d85c",
	'wave',
	'',
	40,
	'../wave.xtuml');
