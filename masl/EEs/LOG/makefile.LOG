MASLLIB=-L/$(HOME)/git/masl/install/lib
MASLINCLUDE=-I/$(HOME)/git/masl/install/include
CXXFLAGS=$(MASLINCLUDE) -Iinclude -fPIC -g -w -fpermissive -Wl,--no-as-needed
OUTDIR=bin
SRCDIR=src

ARTIFACTS=                $(OUTDIR)/libLOG_interface.so \
                          $(OUTDIR)/libLOG.so \
                          $(OUTDIR)/libLOG_sqlite.so \
                          $(OUTDIR)/libLOG_metadata.so \
                          $(OUTDIR)/libLOG_if_metadata.so \
                          $(OUTDIR)/libLOG_inspector.so \
                          $(OUTDIR)/libLOG_if_inspector.so \
                          $(OUTDIR)/libLOG_transient.so

LOG_interface_SOURCES=    $(SRCDIR)/__LOG_types.cc \
                          $(SRCDIR)/__LOG_interface.cc
LOG_interface_OBJECTS=    $(LOG_interface_SOURCES:.cc=.o)
LOG_interface_LIBS=       -lswa -lasn1

LOG_SOURCES=              $(SRCDIR)/__LOG.cc \
                          $(SRCDIR)/__LOG_private_types.cc \
                          $(SRCDIR)/__LOG__LogSuccess.cc \
                          $(SRCDIR)/__LOG__LogFailure.cc \
                          $(SRCDIR)/__LOG__LogInfo.cc \
                          $(SRCDIR)/__LOG__LogInteger.cc
LOG_OBJECTS=              $(LOG_SOURCES:.cc=.o)
LOG_LIBS=                 -lswa -lLOG_interface -lLogger_interface -lFormat_interface

LOG_sqlite_SOURCES=       $(SRCDIR)/sqlite_dummy.cc
LOG_sqlite_OBJECTS=       $(LOG_sqlite_SOURCES:.cc=.o)
LOG_sqlite_LIBS=          -lLOG -lsqlite -lasn1

LOG_metadata_SOURCES=     $(SRCDIR)/MetaData__LOG.cc
LOG_metadata_OBJECTS=     $(LOG_metadata_SOURCES:.cc=.o)
LOG_metadata_LIBS=        -lMetaData -lLOG_interface -lswa

LOG_if_metadata_SOURCES=  $(SRCDIR)/MetaData__if__LOG.cc
LOG_if_metadata_OBJECTS=  $(LOG_if_metadata_SOURCES:.cc=.o)
LOG_if_metadata_LIBS=     -lMetaData -lLOG_interface -lswa

LOG_inspector_SOURCES=    $(SRCDIR)/Inspector__LOG.cc \
                          $(SRCDIR)/Inspector_private_types__LOG.cc
LOG_inspector_OBJECTS=    $(LOG_inspector_SOURCES:.cc=.o)
LOG_inspector_LIBS=       -lInspector -lLOG_if_inspector -lLOG_interface -lboost_system -lswa

LOG_if_inspector_SOURCES= $(SRCDIR)/Inspector_types__LOG.cc
LOG_if_inspector_OBJECTS= $(LOG_if_inspector_SOURCES:.cc=.o)
LOG_if_inspector_LIBS=    -lInspector

LOG_transient_SOURCES=    $(SRCDIR)/transient_dummy.cc
LOG_transient_OBJECTS=    $(LOG_transient_SOURCES:.cc=.o)
LOG_transient_LIBS=       -ltransient -lLOG

all: $(ARTIFACTS)

$(OUTDIR)/libLOG_interface.so: $(LOG_interface_OBJECTS)
	@$(CXX) $(CXXFLAGS) $(MASLLIB) -L$(OUTDIR) -shared $(LOG_interface_OBJECTS) -o $@ $(LOG_interface_LIBS)

$(OUTDIR)/libLOG.so: $(LOG_OBJECTS) $(OUTDIR)/libLOG_interface.so
	@$(CXX) $(CXXFLAGS) $(MASLLIB) -L$(OUTDIR) -shared $(LOG_OBJECTS) -o $@ $(LOG_LIBS)

$(OUTDIR)/libLOG_sqlite.so: $(LOG_sqlite_OBJECTS) $(OUTDIR)/libLOG.so
	@$(CXX) $(CXXFLAGS) $(MASLLIB) -L$(OUTDIR) -shared $(LOG_sqlite_OBJECTS) -o $@ $(LOG_sqlite_LIBS)

$(OUTDIR)/libLOG_metadata.so: $(LOG_metadata_OBJECTS) $(OUTDIR)/libLOG_interface.so
	@$(CXX) $(CXXFLAGS) $(MASLLIB) -L$(OUTDIR) -shared $(LOG_metadata_OBJECTS) -o $@ $(LOG_metadata_LIBS)

$(OUTDIR)/libLOG_if_metadata.so: $(LOG_if_metadata_OBJECTS) $(OUTDIR)/libLOG_interface.so
	@$(CXX) $(CXXFLAGS) $(MASLLIB) -L$(OUTDIR) -shared $(LOG_if_metadata_OBJECTS) -o $@ $(LOG_if_metadata_LIBS)

$(OUTDIR)/libLOG_inspector.so: $(LOG_inspector_OBJECTS) $(OUTDIR)/libLOG_interface.so $(OUTDIR)/libLOG_if_inspector.so
	@$(CXX) $(CXXFLAGS) $(MASLLIB) -L$(OUTDIR) -shared $(LOG_inspector_OBJECTS) -o $@ $(LOG_inspector_LIBS)

$(OUTDIR)/libLOG_if_inspector.so: $(LOG_if_inspector_OBJECTS)
	@$(CXX) $(CXXFLAGS) $(MASLLIB) -L$(OUTDIR) -shared $(LOG_if_inspector_OBJECTS) -o $@ $(LOG_if_inspector_LIBS)

$(OUTDIR)/libLOG_transient.so: $(LOG_transient_OBJECTS) $(OUTDIR)/libLOG.so
	@$(CXX) $(CXXFLAGS) $(MASLLIB) -L$(OUTDIR) -shared $(LOG_transient_OBJECTS) -o $@ $(LOG_transient_LIBS)

.o:
	$(CXX) $(CXXFLAGS) -c $<

clean:
	rm -f $(OUTDIR)/* $(SRCDIR)/*.o
